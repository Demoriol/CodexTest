services:
  gaduly:
    build: ./app
    container_name: gaduly-app
    restart: unless-stopped
    environment:
      - PORT=8080
      - JWT_SECRET=${JWT_SECRET}
      - DB_PATH=/data/gaduly.db
      - UPLOADS_DIR=/data/uploads
    volumes:
      - gaduly_data:/data
    ports:
      - "8080:8080"

  backup:
    image: alpine:3.20
    container_name: gaduly-backup
    restart: unless-stopped
    volumes:
      - gaduly_data:/data
      - ./app/scripts/backup.sh:/backup.sh:ro
    command: >
      sh -c "echo '0 3 * * * /bin/sh /backup.sh >> /var/log/backup.log 2>&1' > /etc/crontabs/root
      && crond -f -l 8"

volumes:
  gaduly_data:
